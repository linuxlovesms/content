{name}Federico Tacacho{/name}{company}Microsoft{/company}{title}Миграция виртуальной машины VMware в облако Azure{/title}{cat}0{/cat}{date}30.03.2016{/date}{desc}Сегодня мы расскажем о миграции VMware в Azure{/desc}

##Пошаговое руководство: Миграция виртуальной машины VMware на платформу Microsoft Azure
Шаг 1:

Прежде всего вам понадобится выполнить преобразование виртуальной машины VMware в формат виртуальной машины Hyper-V с использованием бесплатного инструмента [Virtual Machine Converter](https://www.microsoft.com/en-us/download/details.aspx?id=42497). Все подробности выполнения этой операции описаны в следующей статье: "[Step-By-Step: Migrating From VMware to Microsoft Hyper-V Server 2012](http://blogs.technet.com/b/canitpro/archive/2013/03/25/step-by-step-migrating-from-vmware-to-microsoft-hyper-v-server-2012.aspx)"

Шаг 2:

На второй стадии процесса мы запустим нашу только что конвертированную виртуальную машину на **Hyper-V** и обновим драйверы.

Как только процесс конвертирования виртуальной машины будет завершен, нужно будет обновить сервисы интеграции внутри виртуальной машины Hyper-V. Для того чтобы это выполнить, необходимо приложение Hyper-V Manage.

1) Щелкните пункт **Hyper-V** на панели задач.
2) Выберите опцию **the newly converted virtual machine ("недавно конвертированная виртуальная машина")**	в списке виртуальных машин.

![pic1](https://c.s-microsoft.com/ru-ru/CMSImages/vmware-img02.png?version=f36b17f3-f1fe-e918-1326-fa9c60888b15)

3) Щелкните правой кнопкой мыши на выбранной виртуальной машине и выберите пункт меню **Connect ("Подключить")**	в ниспадающем списке.
4) Выполните вход в виртуальную машину, выбрав комбинацию клавиш **Ctrl-Alt-Del** в верхней левой части строки меню.
5) Введите пароль и получите доступ к вашей виртуальной машине.
6) Щелкните пункт меню **Action ("Действие")**, расположенный в строке меню, и выберите пункт **Insert Integration Services Setup Disk ("Вставить диск настройки служб интеграции")**

![pic2](https://c.s-microsoft.com/ru-ru/CMSImages/vmware-img03.png?version=2fc88cfd-e74a-2a3a-311b-577df3f5f69e)

7) Для того чтобы установить службы **Hyper-V Integration Services**, щелкните **OK**.
8) Щелкните **Yes ("Да")**, чтобы завершить процесс установки и перезапустить виртуальную машину. 
Примечание: При этом к виртуальной машине будут применены обновления.
9) Как только виртуальная машина перезапустится, щелкните пункт **Action ("Действие")**, располагающийся в строке меню, после чего выберите опцию **Turn off ("Выключить")**.
10) Снова выберите опцию **Turn off** в диалоговом окне предупреждения; после этого виртуальная машина выключится.

Шаг 3:

Подготовка к работе виртуальной машины на платформе Azure

Как только драйверы внутри виртуальной машины обновятся, виртуальная машина должна быть скопирована в хранилище данных Azure.

1) Если у вас еще нет учетной записи Microsoft Azure, вы можете завести ее, воспользовавшись одним из следующих бесплатных способов:

- Подписаться на [бесплатную пробную версию](https://bit.ly/Azure_Trial_CEE_RU)	и получить ресурсы Azure на 200 долларов США в течение месяца. 
- Для стартапов: примите участие в программе [BizSpark](http://www.microsoft.com/bizspark)	(при этом вы получите до 120 000 долларов для использования ресурсов Azure) 

Примечание: Во время регистрации вам будет предложено ввести данные вашей кредитной карты, чтобы подтвердить, что вы имеете право на получение бесплатной версии сервиса. Предоставленная вами информация будет использована только для удостоверения вашей личности; вам не нужно будет платить ничего за использование сервиса Azure, если только вы сами позднее не измените условия подписки на платные. 

2) Загрузите и установите модуль [Azure PowerShell](https://azure.microsoft.com/en-us/documentation/articles/powershell-install-configure/). 

3) Щелкните правой кнопкой мыши на значке и выберите пункт меню **Run ISE as Administrator ("Запустить механизм служб идентификации от имени администратора")**

![pic3](https://c.s-microsoft.com/ru-ru/CMSImages/vmware-img04.png?version=e0bba651-daef-edf4-e3a8-7e8cc02efe2d)

Примечание: Примите во внимание, что в вашем случае переменные, используемые в командах PowerShell (например, для обозначения учетной записи хранения Azure и целевых путей размещения виртуального жесткого диска), **могут отличаться от используемых мной в этом примере.**

4) Выполните конфигурирование имени учетной записи хранения Azure с использованием следующей записи PowerShell: 

`$myStorageAcct = "AZUREBOXESLabStor01"`

после чего щелкните кнопку **Run Selection ("Запустить выбранные элементы")**, расположенную в верхней части строки меню. 

5) Задайте исходный путь и путь места назначения, в котором используется виртуальный жесткий диск фиксированного размера, с использованием следующих команд оболочки PowerShell: 

`$mySourceVHD = “D:\VHD\WS2012VM01\disk-0.vhd”`

`$myDestVHD = “http://” + $myStorageAcct + “.blob.core.windows.net/vhds/WS2012VM01-VHD.vhd”`

после чего щелкните кнопку **Run Selection ("Запустить выбранные элементы")**. 

6) Добавьте виртуальный жесткий диск к учетной записи хранения Azure, используя следующие данные ввода PowerShell: 

`Add-AzureVhd – LocalFilePath $mySourceVHD –Destination $myDestVHD`

Для завершения щелкните кнопку **Run Selection**

Примечание: Использование команды add AzureVhd требует применения командлета PowerShell для загрузки виртуального жесткого диска, подготовленного для хранилища данных Azure Storage. Время, которое требуется для осуществления этого процесса, может оказаться различным, в зависимости от размера виртуального жесткого диска и скорости вашего подключения к Интернету. Информация о степени выполнения этой задачи будет автоматически обновляться с ее отображением на экране. 

7) Сопоставьте виртуальный жесткий диск (VHD) реальному диску системы, воспользовавшись следующей записью Azure PowerShell 

`Add-AzureDisk –OS Windows –MediaLocation $myDestVHD –DiskName WS2012VM01-VHD`

щелкните кнопку **Run Selection ("Запустить выбранные элементы")**

Примечание: Как только загрузка виртуального жесткого диска будет завершена, этот диск должен быть зарегистрирован в качестве виртуального. Для этого нам потребуется командлет PowerShell **AzureDisk**. 

8) Для конфигурирования виртуальной машины Azure введите следующие строки в PowerShell: 

`$myVMName = "WS2012VM01" # Задает желаемое имя виртуальной машины` 
`$myCloudService = "WS2012VM01" # должно быть уникальным именем для домена CloudApp.net `

Выберите код и щелкните кнопку **Run Selection**. 

Примечание: Когда новый виртуальный жесткий диск будет выгружен и готов к работе с использованием нашей учетной записи Azure, потребуется сконфигурировать некоторые переменные, что позволит отобразить имя нашей новой виртуальной машины и подключить ее к облачным службам. По завершении этого процесса новая виртуальная машина будет готова к доставке с использованием двух команд PowerShell: **New-AzureVMConfig** и **NewAzureVM**. 

9) Как только шаг 8 будет завершен, продолжайте работу с использованием следующей команды: 

`New-AzureVMConfig –Name $myVMName –InstanceSize Small –DiskName “$myVMName – VHD“ New-AzureVM –ServiceName $myCloudService –location “United States East”`

Когда процесс завершится, мы щелкнем кнопку **Run Selection ("Запустить выбранные элементы")** и откроем браузер Internet Explorer.

10) Выполните вход в портал управления Azure (manage.windowsazure.com) и выберите в окне боковой навигации раздел **virtual machines ("виртуальные машины")**. 

![pic4](https://c.s-microsoft.com/ru-ru/CMSImages/vmware-img05.png?version=4e6851cf-da45-54cd-63fb-d61f957f4149)

Находясь на портале, мы можем убедиться в том, что наша **виртуальная машина** была создана, предварительно сконфигурирована и работает.
